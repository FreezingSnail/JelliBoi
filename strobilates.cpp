#include "strobilates.h"
#include <stdint.h>
uint8_t swimPattern[] = { 0, 4, 0, 8, 12, 12, 12, 8, 0};
int swimframe = 0;
bool swimming = false;

const int growthModifier = 2;
const uint8_t PROGMEM strobolateAnimation[]  =
{
// width, height,
16, 16,
// TILE 00
0x00, 0x00, 0x00, 0x03, 0x04, 0xfb, 0xfc, 0xfc, 0xff, 0xfc, 0xfb, 0x04, 0x03, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8f, 0xff, 0xff, 0x8f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
// TILE 01
0x00, 0x00, 0x00, 0x03, 0x04, 0xfb, 0xac, 0xfc, 0xff, 0xac, 0xfb, 0x04, 0x03, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8f, 0xfa, 0xfa, 0x8f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
// TILE 02
0x00, 0x00, 0x00, 0x03, 0x04, 0xfb, 0xac, 0x54, 0xaf, 0x54, 0xfb, 0x04, 0x03, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8f, 0xf6, 0xf9, 0x8f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
// TILE 03
0x00, 0x00, 0x00, 0x03, 0x06, 0xfd, 0xae, 0x55, 0xae, 0x55, 0xfe, 0x05, 0x03, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8f, 0xf6, 0xf9, 0x8f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
// TILE 04
0x00, 0x00, 0x00, 0x07, 0x3e, 0xf5, 0xae, 0x75, 0xae, 0x75, 0xee, 0x3d, 0x07, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x8f, 0xfd, 0xfb, 0x8f, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 
// TILE 05
0x00, 0x00, 0x03, 0x1d, 0xee, 0x75, 0xae, 0x75, 0xae, 0x75, 0xae, 0xf5, 0x1e, 0x03, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xbb, 0xfd, 0xfb, 0xbd, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 
// TILE 06
0x00, 0x00, 0x0c, 0xd4, 0x58, 0x94, 0x58, 0x94, 0x58, 0x94, 0x58, 0x94, 0xd8, 0x0c, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x07, 0x3b, 0xdd, 0xeb, 0xdd, 0xeb, 0x3d, 0x07, 0x00, 0x00, 0x00, 0x00, 
// TILE 07
0x00, 0x00, 0x00, 0xc4, 0x58, 0x94, 0x58, 0x94, 0x58, 0x94, 0x58, 0x9c, 0xc4, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x07, 0x3b, 0xdd, 0xeb, 0xdd, 0xeb, 0x3d, 0x07, 0x00, 0x00, 0x00, 0x00, 
// TILE 08
0x00, 0x00, 0x00, 0xc0, 0x4e, 0x9c, 0x58, 0x9e, 0x58, 0x9e, 0x58, 0x8e, 0xc0, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x07, 0x3b, 0xdd, 0xeb, 0xdd, 0xeb, 0x3d, 0x07, 0x00, 0x00, 0x00, 0x00, 
// TILE 09
0x00, 0x00, 0x00, 0xc0, 0x42, 0x8e, 0x58, 0x9e, 0x58, 0x9e, 0x4c, 0x82, 0xc0, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x07, 0x3b, 0xdd, 0xeb, 0xdd, 0xeb, 0x3d, 0x07, 0x00, 0x00, 0x00, 0x00, 
// TILE 10
0x00, 0x00, 0x00, 0x80, 0x84, 0x0c, 0x98, 0x1c, 0x98, 0x1c, 0x8c, 0x04, 0x80, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x01, 0x0e, 0x77, 0xba, 0xd7, 0xba, 0xd7, 0x7a, 0x0f, 0x01, 0x00, 0x00, 0x00, 
// TILE 11
0x00, 0x00, 0x00, 0x00, 0x04, 0x0e, 0x1e, 0x1e, 0x1e, 0x1e, 0x0e, 0x04, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x03, 0x1d, 0xee, 0x75, 0xae, 0x75, 0xae, 0xf5, 0x1e, 0x03, 0x00, 0x00, 0x00, 
// TILE 12
0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x1e, 0x1e, 0x1e, 0x1e, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x06, 0x3a, 0xdc, 0xea, 0x5c, 0xea, 0x5c, 0xea, 0x3c, 0x06, 0x00, 0x00, 0x00, 
// TILE 13
0x00, 0x00, 0x00, 0x00, 0x08, 0x1c, 0x0e, 0x1e, 0x1e, 0x0e, 0x1c, 0x08, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x06, 0x3a, 0xdc, 0xea, 0x5c, 0xea, 0x5c, 0xea, 0x3c, 0x06, 0x00, 0x00, 0x00, 
// TILE 14
0x00, 0x00, 0x00, 0x00, 0x10, 0x1c, 0x06, 0x1e, 0x06, 0x1e, 0x0c, 0x10, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x0c, 0x74, 0xb8, 0xd4, 0xb8, 0xd4, 0xb8, 0xd4, 0x78, 0x0c, 0x00, 0x00, 0x00, 
};

const uint8_t PROGMEM strobSwim[] =
{
// width, height,
8, 8,
// TILE 00 a1 00
0x20, 0x38, 0x0c, 0x3c, 0x0c, 0x3c, 0x18, 0x20, 
// TILE 01 b1 10
0x00, 0x00, 0x3c, 0x7e, 0x56, 0xd5, 0x00, 0x00, 
// TILE 02 c1 20
0x04, 0x18, 0x3c, 0x30, 0x3c, 0x30, 0x1c, 0x04, 
// TILE 03 d1 30
0x00, 0x00, 0xab, 0x6a, 0x7e, 0x3c, 0x00, 0x00, 
// TILE 04 a2 01
0x18, 0x1c, 0x0c, 0x1c, 0x0c, 0x1c, 0x0c, 0x18, 
// TILE 05 b2 11
0x00, 0x00, 0x7e, 0xff, 0xd5, 0x00, 0x00, 0x00, 
// TILE 06 c2 21
0x18, 0x30, 0x38, 0x30, 0x38, 0x30, 0x38, 0x18, 
// TILE 07 d2 31
0x00, 0x00, 0x00, 0xab, 0xff, 0x7e, 0x00, 0x00, 
// TILE 08 a3 02
0x00, 0x38, 0x0c, 0x7c, 0x7c, 0x0c, 0x38, 0x00, 
// TILE 09 b3 12
0x00, 0x00, 0x3c, 0x7e, 0x5a, 0x5a, 0x18, 0x00, 
// TILE 10 c3 22
0x00, 0x1c, 0x30, 0x3e, 0x3e, 0x30, 0x1c, 0x00, 
// TILE 11 d3 32
0x00, 0x18, 0x5a, 0x5a, 0x7e, 0x3c, 0x00, 0x00, 
// TILE 12 a4 03
0x00, 0x18, 0x2c, 0x7c, 0x7c, 0x2c, 0x18, 0x00, 
// TILE 13 b4 13
0x00, 0x00, 0x3c, 0x7e, 0x5a, 0x3c, 0x18, 0x00, 
// TILE 14 c4 23
0x00, 0x18, 0x34, 0x3e, 0x3e, 0x34, 0x18, 0x00, 
// TILE 15 d4 34
0x00, 0x18, 0x3c, 0x5a, 0x7e, 0x3c, 0x00, 0x00, 
};

strob::strob(int xStart, int yStart){
  x = xStart;
  y = yStart;
}

void strob::drawStrob(){
  if (counter <= 14*growthModifier){
  sprite.drawSelfMasked(x, y, strobolateAnimation, counter/growthModifier);
  }
  else if (counter > 14*growthModifier && swimming ==true){
    sprite.drawSelfMasked(x, y, strobSwim, swimPattern[swimframe]+ direct);
    swimframe++;
  }
  else {
    sprite.drawSelfMasked(x, y, strobSwim, direct);
   
  }
  if(swimframe > 8){
    swimming = false;
    swimframe = 0;
    } 
}

void strob::updateStrob(){
  
 if (swimming == false){ setDirection(); }
 
 
 if(frameCounter % 4 == 0 && counter > 14*growthModifier){
      x--;
 }
    if (counter < 30){
    counter++;}
    else{
      growing = false;
    }
    
 if( arduboy.justPressed(B_BUTTON) && counter > 14*growthModifier){
    swimming = true;
    
    switch (direct){
    case 0:
    ySpeed =-4;
    break;
    case 1:
    xSpeed = -4;
    break;
    case 2:
    ySpeed = 4;
    break;
    case 3:
    xSpeed = 4;
    break;
    }
  }

  x+= xSpeed;
  y+= ySpeed;
  
  if (xSpeed > 0){ xSpeed--;}
  else if (xSpeed < 0){ xSpeed++;}
  if (ySpeed > 0){ ySpeed--;}
  else if (ySpeed < 0){ ySpeed++;}
  

  if(x > 120){
    x = 120;
  }
  else if( x < 0 ){
    x = 0; 
  }
  else if(y > 46){
    y = 46; 
  }
  else if( y < 13){
    y = 13;
  }

}
 


void strob::setDirection(){
  
  if (playerDirection == up){
    direct = 0;   
  }
  else  if (playerDirection == left){
    direct = 1;
  }
  else  if (playerDirection == down){
    direct = 2;
  }
  else  if (playerDirection == right){
    direct = 3;
  }
}

